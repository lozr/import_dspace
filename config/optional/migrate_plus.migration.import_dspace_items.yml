# Migration configuration for imported articles.
# Available expands: parentCollection, parentCollectionList, parentCommunityList, bitstreams, all
id: import_dspace_items
label: Import items from DSspace
migration_group: DSpace Import
migration_dependencies:
  required:
    - import_dspace_bitstreams
dependencies:
  enforced:
    module:
      - import_dspace

destination:
  plugin: entity:node
  bundle: article

source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  # local file relative to the Drupal root - make it online in future
  urls: 
    - 'public://json_source/items.json'
  # the json nesting level and key
  item_selector: /
  # the json fields
  fields:
    -
      name: src_id
      label: 'id'
      selector: id
    -
      name: src_name
      label: 'Name'
      selector: name
    -
      name: src_changed
      label: 'Changed'
      selector: lastModified
    -
      name: src_archived
      label: 'Archived'
      selector: archived
    -
      name: src_handle
      label: 'Handle'
      selector: handle
    -
      name: src_files
      label: 'Files'
      selector: 'bitstreams/id'
    -
  # unique ids for this import by name
  ids:
    src_id:
      type: integer
  

process:
  type:
    plugin: default_value
    default_value: article

  uuid: uuid
  title: name
  created: timestamp
  changed: changed
  
  field_file:
    plugin: migration_lookup
    migration: import_dspace_bitstreams
    source: src_files

  uid:
    plugin: default_value
    default_value: 1
